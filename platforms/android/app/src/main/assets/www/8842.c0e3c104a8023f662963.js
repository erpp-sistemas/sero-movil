(self.webpackChunkerpp_movil=self.webpackChunkerpp_movil||[]).push([[8842],{8842:(t,e,o)=>{"use strict";o.r(e),o.d(e,{MapaGooglePageModule:()=>y});var i=o(61116),n=o(11462),a=o(54812),s=o(9069),l=o(64762),r=o(38599),c=o(87368),g=o(75919),h=o(9935),d=o(90074),p=o(18372);const u=[{path:"",component:(()=>{class t{constructor(t,e,o,i,n,a,s,l){this.platform=t,this.loadingCtrl=e,this.rest=o,this.mensaje=i,this.router=n,this.activeRoute=a,this.callNumber=s,this.storage=l,this.accountString="",this.mapStyle=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.platform.ready(),console.log(this.activeRoute.snapshot.paramMap.get("id")),console.log(this.activeRoute.snapshot.paramMap.get("id_plaza")),this.idServicioPlaza=this.activeRoute.snapshot.paramMap.get("id"),this.id_plaza=this.activeRoute.snapshot.paramMap.get("id_plaza"),yield this.getAccountInfo(this.id_plaza,this.idServicioPlaza)})}isNight(){let t=(new Date).getHours();return!(t>5&&t<19)}getAccountInfo(t,e){return(0,l.mG)(this,void 0,void 0,function*(){console.log("GetAccountInfo"),this.markersArrayInfo=yield this.rest.getDataVisitPosition(t,e),this.markersArrayInfo.length<=0?(this.mensaje.showAlert("Tienes que descargar informaci\xf3n para visualizar las cuentas en el mapa!!!!"),this.router.navigateByUrl("/home")):(this.loading=yield this.loadingCtrl.create({message:"Cargando cuentas en el mapa..."}),yield this.loading.present(),yield this.setMarkers(this.markersArrayInfo))})}setMarkers(t){console.log("Set markers");let e=[];for(let o of t){let t=new r.MP(parseFloat(o.latitud),parseFloat(o.longitud));e.push({position:t,cuenta:o.cuenta,propietario:o.propietario,deuda:o.total})}console.log("array",e),this.loadMap(e)}detalleCuenta(t){console.log(t),this.htmlInfoWindow=new r.rb,this.frame=document.createElement("div"),this.frame.innerHTML=['<div style="text-align:center"> <img style="width:30px; height:30px" src="assets/icon/sero.png"> </div>','<h3 style="font-size:16px; text-align:center">Informaci\xf3n de la cuenta</h3>','<p style="font-size:14px"> <strong> Cuenta: </strong> '+t.cuenta+"</p>",'<p style="font-size:14px"> <strong> Propietario: </strong> '+t.propietario+"</p>",'<p style="font-size:14px"> <strong> Deuda: </strong>$ '+t.deuda+"</p>",'<button style="background-color: rgb(0,200,0); width: 95%; padding: 10px 0; color:white; border-radius:10px" >Gestionar</button>'].join(""),this.frame.getElementsByTagName("button")[0].addEventListener("click",()=>{this.gestionar(t.cuenta)}),this.htmlInfoWindow.setContent(this.frame,{width:"280px",height:"230px"})}gestionar(t){console.log("Cuenta ",t),this.storage.set("account",t),this.router.navigateByUrl("/gestion-page")}loadMap(t){return(0,l.mG)(this,void 0,void 0,function*(){let e=[];this.isNight()&&(e=this.mapStyle),this.map=r.hz.create("map_canvas",{mapType:r.OE.HYBRID,controls:{compass:!0,myLocationButton:!0,myLocation:!0,mapToolbar:!0},gestures:{scroll:!0,tilt:!0,zoom:!0,rotate:!0},styles:e}),this.loading.dismiss(),this.loading=yield this.loadingCtrl.create({message:"Cargando el mapa",spinner:"dots"}),this.loading.present(),this.map.getMyLocation().then(e=>{this.loading.dismiss(),console.log(JSON.stringify(e,null,2)),this.latitud=e.latLng.lat.toString(),this.longitud=e.latLng.lng.toString(),this.map.animateCamera({target:e.latLng,zoom:12,tilt:30}),this.map.addMarkerSync({title:"Mi ubicaci\xf3n actual",position:e.latLng,animation:r.sF.BOUNCE,icon:{url:"./assets/icon/sero.png",size:{width:30,height:30}}}).showInfoWindow();let o="./assets/icon/icono-predio.png";1==this.idServicioPlaza?o="./assets/icon/gota.png":2==this.idServicioPlaza&&(o="./assets/icon/icono-predio.png");let i={url:o,size:{width:35,height:35}};for(let n of t){let t=this.map.addMarkerSync({position:n.position,icon:i});t.on(r.mZ.MARKER_CLICK).subscribe(()=>{console.log(n.cuenta),console.log(n.deuda),this.detalleCuenta(n),this.htmlInfoWindow.open(t)})}}).catch(t=>{console.log(t),this.loading.dismiss()})})}trazarRuta(){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];for(let e of this.markersArrayInfo){let o=new r.MP(parseFloat(e.latitud),parseFloat(e.longitud));t.push({position:o,cuenta:e.cuenta,propietario:e.propietario,deuda:e.total})}setTimeout(()=>{this.loading.dismiss(),this.addPolylines(t)},2e3),this.loading=yield this.loadingCtrl.create({message:"Trazando ruta...",spinner:"dots"}),this.loading.present()})}addPolylines(t){console.log(t);let e=new r.MP(parseFloat(this.latitud),parseFloat(this.longitud));console.log(e);let o=[];o.push(e);for(let i of t)o.push(i.position);console.log(o),this.map.addPolylineSync({points:o,color:"#0995F2",width:10,geodesic:!0,clickable:!0}).on(r.mZ.POLYLINE_CLICK).subscribe(t=>{let e=t[0];this.map.addMarker({position:e,title:e.toUrlValue(),disableAutoPan:!0}).then(t=>{t.showInfoWindow()})})}obtenerDistancias(){return(0,l.mG)(this,void 0,void 0,function*(){let t=yield this.storage.get("IdAspUser");this.cuentasDistancia=yield this.rest.obtenerCuentasDistancias(t,this.id_plaza,this.idServicioPlaza,this.latitud,this.longitud);let e=[];for(let o of this.cuentasDistancia){let t=new r.MP(o.latitud,o.longitud);e.push({position:t})}setTimeout(()=>{this.loading.dismiss(),this.addPolylines(e)},2e3),this.loading=yield this.loadingCtrl.create({message:"Trazando ruta...",spinner:"dots"}),this.loading.present()})}find(){return(0,l.mG)(this,void 0,void 0,function*(){if(""==this.accountString)alert("Ingresa una cuenta");else if(this.result=yield this.rest.getDataVisitPositionByAccount(this.accountString),console.log(this.result),0==this.result.length)alert("No hay resultados");else{let t=new r.MP(this.result[0].latitud,this.result[0].longitud);console.log(t),this.map.setCameraTarget(t),this.map.setCameraZoom(20)}})}navegar(t){1==t?this.router.navigateByUrl("home/tab1"):2==t?this.router.navigateByUrl("home/tab2"):3==t?this.router.navigateByUrl("home/tab3"):4==t?this.router.navigateByUrl("home/tab4"):5==t&&this.callNumber.callNumber("911",!0).then(t=>console.log("Launched dialer!",t)).catch(t=>console.log("Error launching dialer",t))}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(a.t4),c.Y36(a.HT),c.Y36(g.v),c.Y36(h.K),c.Y36(s.F0),c.Y36(s.gz),c.Y36(d.X),c.Y36(p.Ke))},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-mapa-google"]],decls:40,vars:1,consts:[["placeholder","Buscar por cuenta",3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["name","search"],["id","map_canvas"],["vertical","bottom","horizontal","end","slot","fixed"],["color","success",3,"click"],["name","analytics-outline"],["scrollable",""],["color","light","name","home"],["color","light",2,"font-size","2px"],["color","light","name","layers"],["color","light","name","map"],["color","light","name","warning"],["src","../../../assets/img/sos.png","alt","",2,"width","30px","height","30px","margin-bottom","-15px"],["color","light",2,"font-size","3px","margin-bottom","-1px"]],template:function(t,e){1&t&&(c._UZ(0,"hr"),c._UZ(1,"hr"),c._UZ(2,"hr"),c._UZ(3,"hr"),c.TgZ(4,"ion-content"),c.TgZ(5,"ion-toolbar"),c.TgZ(6,"ion-input",0),c.NdJ("ngModelChange",function(t){return e.accountString=t}),c.qZA(),c.TgZ(7,"ion-buttons",1),c.TgZ(8,"ion-button",2),c.NdJ("click",function(){return e.find()}),c._UZ(9,"ion-icon",3),c.qZA(),c.qZA(),c.qZA(),c._UZ(10,"div",4),c.TgZ(11,"ion-fab",5),c.TgZ(12,"ion-fab-button",6),c.NdJ("click",function(){return e.obtenerDistancias()}),c._UZ(13,"ion-icon",7),c.qZA(),c.qZA(),c.qZA(),c.TgZ(14,"ion-segment",8),c.TgZ(15,"ion-segment-button",2),c.NdJ("click",function(){return e.navegar(1)}),c._UZ(16,"ion-icon",9),c.TgZ(17,"ion-label",10),c.TgZ(18,"small"),c._uU(19,"Inicio"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(20,"ion-segment-button",2),c.NdJ("click",function(){return e.navegar(2)}),c._UZ(21,"ion-icon",11),c.TgZ(22,"ion-label",10),c.TgZ(23,"small"),c._uU(24,"Cuentas"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(25,"ion-segment-button",2),c.NdJ("click",function(){return e.navegar(3)}),c._UZ(26,"ion-icon",12),c.TgZ(27,"ion-label",10),c.TgZ(28,"small"),c._uU(29,"Mapa"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(30,"ion-segment-button",2),c.NdJ("click",function(){return e.navegar(4)}),c._UZ(31,"ion-icon",13),c.TgZ(32,"ion-label",10),c.TgZ(33,"small"),c._uU(34,"S.P\xfablicos"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(35,"ion-segment-button",2),c.NdJ("click",function(){return e.navegar(5)}),c._UZ(36,"img",14),c.TgZ(37,"ion-label",15),c.TgZ(38,"small"),c._uU(39,"S.O.S."),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(6),c.Q6J("ngModel",e.accountString))},directives:[a.W2,a.sr,a.pK,a.j9,n.JJ,n.On,a.Sm,a.YG,a.gu,a.IJ,a.W4,a.cJ,a.QI,a.GO,a.Q$],styles:["#map_canvas[_ngcontent-%COMP%]{height:100%;width:100%}ion-segment[_ngcontent-%COMP%]{--background:#254061;border-top:1px solid #0000001a;height:60px;margin-bottom:-5px}ion-segment-button[_ngcontent-%COMP%]{--indicator-color:#0000!important}"]}),t})()}];let m=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[s.Bz.forChild(u)],s.Bz]}),t})(),y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[i.ez,n.u5,a.Pc,m]]}),t})()}}]);