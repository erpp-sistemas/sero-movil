(self.webpackChunkerpp_movil=self.webpackChunkerpp_movil||[]).push([[3175],{63175:(e,t,o)=>{"use strict";o.r(t),o.d(t,{MapaPruebaPageModule:()=>y});var i=o(61116),n=o(11462),a=o(54812),s=o(9069),l=o(64762),r=o(87368),c=o(2977),g=o(75919),p=o(9935),d=o(90074),u=o(18372);const h=[{path:"",component:(()=>{class e{constructor(e,t,o,i,n,a,s,l,r){this.geolocation=e,this.rest=t,this.mensaje=o,this.router=i,this.loadingCtrl=n,this.platform=a,this.activeRoute=s,this.callNumber=l,this.storage=r,this.latitud=19.26187,this.longitud=-98.895795,this.infoWindows=[],this.accountString="",this.wayPoints=[],this.mapStyle=[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]}ngOnInit(){return(0,l.mG)(this,void 0,void 0,function*(){yield this.platform.ready(),console.log(this.activeRoute.snapshot.paramMap.get("id")),console.log(this.activeRoute.snapshot.paramMap.get("id_plaza")),this.idServicioPlaza=this.activeRoute.snapshot.paramMap.get("id"),this.id_plaza=this.activeRoute.snapshot.paramMap.get("id_plaza"),yield this.getAccountInfo(this.id_plaza,this.idServicioPlaza)})}isNight(){let e=(new Date).getHours();return!(e>5&&e<19)}getAccountInfo(e,t){return(0,l.mG)(this,void 0,void 0,function*(){console.log("GetAccountInfo"),this.markersArrayInfo=yield this.rest.getDataVisitPosition(e,t),console.log(this.markersArrayInfo),this.markersArrayInfo.length<=0?(this.mensaje.showAlert("Tienes que descargar informaci\xf3n para visualizar las cuentas en el mapa, o tus cuentas a\xfan no tienen posici\xf3n"),this.router.navigateByUrl("/home")):(this.loading=yield this.loadingCtrl.create({message:"Cargando cuentas en el mapa..."}),yield this.loading.present(),yield this.setMarkers(this.markersArrayInfo))})}setMarkers(e){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];for(let o of e){let e=new google.maps.LatLng(parseFloat(o.latitud),parseFloat(o.longitud));t.push({position:e,cuenta:o.cuenta,propietario:o.propietario,deuda:o.total,id_proceso:o.id_proceso,proceso_gestion:o.proceso_gestion,url_aplicacion_movil:o.url_aplicacion_movil,icono_proceso:o.icono_proceso})}this.initMap(t)})}initMap(e){return(0,l.mG)(this,void 0,void 0,function*(){let t=[];this.isNight()&&(t=this.mapStyle);const o=yield this.geolocation.getCurrentPosition();let i=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);console.log("latlng",i);let n={center:i,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:t};this.map=new google.maps.Map(document.getElementById("map_canvas"),n),this.loading.dismiss(),this.loading=yield this.loadingCtrl.create({message:"Cargando el mapa",spinner:"dots"}),this.loading.present(),this.latitud=o.coords.latitude,this.longitud=o.coords.longitude;let a={url:"./assets/icon/sero.png",scaledSize:new google.maps.Size(30,30)},s=new google.maps.Marker({map:this.map,animation:google.maps.Animation.DROP,position:this.map.getCenter(),icon:a});this.loading.dismiss(),this.addInfoWindowUbicacion(s);let l,r="";1==this.idServicioPlaza?(r="./assets/icon/gota.png",l=new google.maps.Size(30,30)):2==this.idServicioPlaza?(r="./assets/icon/icono-predio.png",l=new google.maps.Size(30,30)):3==this.idServicioPlaza?(r="./assets/icon/antena.png",l=new google.maps.Size(30,30)):4==this.idServicioPlaza&&(r="./assets/icon/comercio.png",l=new google.maps.Size(60,30));let c={url:r,scaledSize:l};for(let g of e){let e=new google.maps.Marker({map:this.map,position:g.position,icon:c});this.addInfoWindow(e,g)}})}addInfoWindowUbicacion(e){let t=new google.maps.InfoWindow({content:'\n        <div style="text-align:center;">\n          <p>Ubicaci\xf3n actual</p>\n        </div>\n      '});e.addListener("click",()=>{this.closeAllInfoWindow(),t.open(this.map,e)})}addInfoWindow(e,t){let o=new google.maps.InfoWindow({content:`\n        <div style="text-align:center;">\n          <img style="width:40px;" src="assets/icon/sero.png" alt="">\n          <h6 style="color:black">Informaci\xf3n de la cuenta</h6>\n          <p style="color:black"> <span style="font-weight: bold; paddin: 0; margin:1px">Cuenta: </span> ${t.cuenta} </p>\n          <p style="color:black"> <span style="font-weight: bold; paddin: 0; margin:1px">Propietario: </span> ${t.propietario} </p>\n          <p style="color:black"> <span style="font-weight: bold; paddin: 0; margin:1px">Deuda: </span>$${t.deuda} </p>\n          <p style="color:black"> <span style="font-weight: bold; paddin: 0; margin:1px">Proceso: </span>${t.proceso_gestion} </p>\n          <ion-button color="success" id="btnGestionar"  >Gestionar</ion-button>\n        </div>\n      `});e.addListener("click",()=>{this.closeAllInfoWindow(),o.open(this.map,e),google.maps.event.addListenerOnce(o,"domready",()=>{document.getElementById("btnGestionar").addEventListener("click",()=>{console.log(t),this.gestionar(t)})})}),this.infoWindows.push(o)}closeAllInfoWindow(){for(let e of this.infoWindows)e.close()}gestionar(e){return(0,l.mG)(this,void 0,void 0,function*(){let{cuenta:t,id_proceso:o,proceso_gestion:i,url_aplicacion_movil:n,icono_proceso:a}=e;console.log("Cuenta ",t),yield this.storage.set("account",t),yield this.storage.set("id_proceso",o),yield this.storage.set("proceso_gestion",i),yield this.storage.set("icono_proceso",a),this.router.navigateByUrl(n)})}trazarRutaParcial(){return(0,l.mG)(this,void 0,void 0,function*(){let e,t=yield this.storage.get("IdAspUser"),o=[];this.cuentasDistancia=yield this.rest.obtenerCuentasDistancias(t,this.id_plaza,this.idServicioPlaza,this.latitud,this.longitud),console.log(this.cuentasDistancia);let i=[];this.rest.getDataVisitPositionDistance(this.id_plaza,this.idServicioPlaza,this.cuentasDistancia).then(e=>{i=e}),this.loading=yield this.loadingCtrl.create({message:"Calculando la ruta de m\xe1ximo 25 cuentas",spinner:"dots"}),yield this.loading.present(),setTimeout(()=>(0,l.mG)(this,void 0,void 0,function*(){const t=yield this.geolocation.getCurrentPosition();this.positionActual=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),console.log(i);let n=i.length;if(n>=25){console.log("Tiene 25 o mas cuentas");for(let t=0;t<=23;t++)o.push({location:{lat:parseFloat(this.cuentasDistancia[t].latitud),lng:parseFloat(this.cuentasDistancia[t].longitud)},stopover:!1}),23==t&&(e=new google.maps.LatLng(parseFloat(this.cuentasDistancia[t].latitud),parseFloat(this.cuentasDistancia[t].longitud)))}else{console.log("Tienes menos de 25 cuentas");for(let t=0;t<n;t++)o.push({location:{lat:parseFloat(this.cuentasDistancia[t].latitud),lng:parseFloat(this.cuentasDistancia[t].longitud)},stopover:!1}),t==n-1&&(e=new google.maps.LatLng(parseFloat(this.cuentasDistancia[t].latitud),parseFloat(this.cuentasDistancia[t].longitud)))}this.calcularRuta(this.positionActual,e,o),this.loading.dismiss()}),2e3)})}calcularRuta(e,t,o){console.log("Calculando ruta"),console.log(o);var i=new google.maps.DirectionsService,n=new google.maps.DirectionsRenderer;let a={origin:e,destination:t,waypoints:o,optimizeWaypoints:!0,travelMode:google.maps.TravelMode.WALKING};i.route(a,(e,t)=>{"OK"==t&&n.setDirections(e)}),n.setMap(this.map)}find(){return(0,l.mG)(this,void 0,void 0,function*(){if(""==this.accountString)alert("Ingresa una cuenta");else if(this.result=yield this.rest.getDataVisitPositionByAccount(this.accountString),console.log(this.result),0==this.result.length)alert("No hay resultados");else{let e=parseFloat(this.result[0].latitud),t=parseFloat(this.result[0].longitud);this.map.moveCamera({tilt:0,heading:0,zoom:18,center:{lat:e,lng:t}})}})}navegar(e){1==e?this.router.navigateByUrl("home/tab1"):2==e?this.router.navigateByUrl("home/tab2"):3==e?this.router.navigateByUrl("home/tab3"):4==e?this.router.navigateByUrl("home/tab4"):5==e&&this.callNumber.callNumber("911",!0).then(e=>console.log("Launched dialer!",e)).catch(e=>console.log("Error launching dialer",e))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(c.b),r.Y36(g.v),r.Y36(p.K),r.Y36(s.F0),r.Y36(a.HT),r.Y36(a.t4),r.Y36(s.gz),r.Y36(d.X),r.Y36(u.Ke))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-mapa-prueba"]],decls:40,vars:1,consts:[["color","light"],["color","light","placeholder","Buscar por cuenta",2,"background-color","#f4f5f8","color","black",3,"ngModel","ngModelChange"],["slot","end"],[3,"click"],["color","dark","name","search"],["id","map_canvas"],["vertical","bottom","horizontal","start","slot","fixed"],["color","success",3,"click"],["name","analytics-outline"],["scrollable",""],["color","light","name","home"],["color","light",2,"font-size","2px"],["color","light","name","layers"],["color","light","name","map"],["color","light","name","warning"],["src","../../../assets/img/sos.png","alt","",2,"width","30px","height","30px","margin-bottom","-15px"],["color","light",2,"font-size","3px","margin-bottom","-1px"]],template:function(e,t){1&e&&(r._UZ(0,"hr"),r._UZ(1,"hr"),r._UZ(2,"hr"),r._UZ(3,"hr"),r.TgZ(4,"ion-content"),r.TgZ(5,"ion-toolbar",0),r.TgZ(6,"ion-input",1),r.NdJ("ngModelChange",function(e){return t.accountString=e}),r.qZA(),r.TgZ(7,"ion-buttons",2),r.TgZ(8,"ion-button",3),r.NdJ("click",function(){return t.find()}),r._UZ(9,"ion-icon",4),r.qZA(),r.qZA(),r.qZA(),r._UZ(10,"div",5),r.TgZ(11,"ion-fab",6),r.TgZ(12,"ion-fab-button",7),r.NdJ("click",function(){return t.trazarRutaParcial()}),r._UZ(13,"ion-icon",8),r.qZA(),r.qZA(),r.qZA(),r.TgZ(14,"ion-segment",9),r.TgZ(15,"ion-segment-button",3),r.NdJ("click",function(){return t.navegar(1)}),r._UZ(16,"ion-icon",10),r.TgZ(17,"ion-label",11),r.TgZ(18,"small"),r._uU(19,"Inicio"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(20,"ion-segment-button",3),r.NdJ("click",function(){return t.navegar(2)}),r._UZ(21,"ion-icon",12),r.TgZ(22,"ion-label",11),r.TgZ(23,"small"),r._uU(24,"Cuentas"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(25,"ion-segment-button",3),r.NdJ("click",function(){return t.navegar(3)}),r._UZ(26,"ion-icon",13),r.TgZ(27,"ion-label",11),r.TgZ(28,"small"),r._uU(29,"Mapa"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(30,"ion-segment-button",3),r.NdJ("click",function(){return t.navegar(4)}),r._UZ(31,"ion-icon",14),r.TgZ(32,"ion-label",11),r.TgZ(33,"small"),r._uU(34,"S.P\xfablicos"),r.qZA(),r.qZA(),r.qZA(),r.TgZ(35,"ion-segment-button",3),r.NdJ("click",function(){return t.navegar(5)}),r._UZ(36,"img",15),r.TgZ(37,"ion-label",16),r.TgZ(38,"small"),r._uU(39,"S.O.S."),r.qZA(),r.qZA(),r.qZA(),r.qZA()),2&e&&(r.xp6(6),r.Q6J("ngModel",t.accountString))},directives:[a.W2,a.sr,a.pK,a.j9,n.JJ,n.On,a.Sm,a.YG,a.gu,a.IJ,a.W4,a.cJ,a.QI,a.GO,a.Q$],styles:["#map_canvas[_ngcontent-%COMP%]{width:100%;height:95%}ion-segment[_ngcontent-%COMP%]{--background:#254061;border-top:1px solid #0000001a;height:60px;margin-bottom:-5px}ion-segment-button[_ngcontent-%COMP%]{--indicator-color:#0000!important}"]}),e})()}];let m=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[s.Bz.forChild(h)],s.Bz]}),e})(),y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[i.ez,n.u5,a.Pc,m]]}),e})()}}]);