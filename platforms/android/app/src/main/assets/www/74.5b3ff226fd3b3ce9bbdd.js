(self.webpackChunkerpp_movil=self.webpackChunkerpp_movil||[]).push([[74],{74:(i,t,e)=>{"use strict";e.r(t),e.d(t,{Tab1PageModule:()=>T});var o=e(54812),s=e(61116),a=e(11462),n=e(60940),r=e(9069),c=e(64762),l=e(87368),d=e(18372),g=e(75919),h=e(9935);function p(i,t){if(1&i&&(l.TgZ(0,"div"),l._UZ(1,"img",10),l.qZA()),2&i){const i=l.oxw();l.xp6(1),l.Q6J("src",i.imgUser,l.LSH)}}function u(i,t){1&i&&(l.TgZ(0,"div"),l._UZ(1,"img",11),l.qZA())}function m(i,t){if(1&i&&(l.TgZ(0,"ion-select-option",12),l._uU(1),l.ALo(2,"titlecase"),l.qZA()),2&i){const i=t.$implicit;l.Q6J("value",i.id_plaza),l.xp6(1),l.hij(" ",l.lcZ(2,2,i.plaza)," ")}}function v(i,t){1&i&&(l.TgZ(0,"div",13),l._UZ(1,"img",14),l.TgZ(2,"ion-chip",5),l._uU(3,"No se pudo cargar la informaci\xf3n"),l.qZA(),l.TgZ(4,"ion-chip",5),l._uU(5,"Verifica con el coordinador de tu plaza"),l.qZA(),l.qZA())}function f(i,t){if(1&i&&l._UZ(0,"img",26),2&i){const i=l.oxw().$implicit;l.Q6J("src",i.icono_app_movil,l.LSH)}}function _(i,t){if(1&i&&l._UZ(0,"ion-icon",27),2&i){const i=l.oxw().$implicit;l.Q6J("name",i.icono_app_movil)}}function Z(i,t){1&i&&l._UZ(0,"ion-icon",28)}function z(i,t){if(1&i){const i=l.EpF();l.TgZ(0,"ion-item-sliding"),l.TgZ(1,"ion-item-options",16),l.TgZ(2,"ion-item-option",17),l.NdJ("click",function(){const t=l.CHM(i).$implicit;return l.oxw(2).goCuentasTab(t.id_servicio)}),l._UZ(3,"ion-icon",18),l.qZA(),l.qZA(),l.TgZ(4,"ion-item",19),l.NdJ("click",function(){const t=l.CHM(i).$implicit;return l.oxw(2).confirmarDescarga(t.id_servicio,t.plaza,t.servicio)}),l.YNc(5,f,1,1,"img",20),l.TgZ(6,"p",21),l._uU(7),l.qZA(),l.YNc(8,_,1,1,"ion-icon",22),l.YNc(9,Z,1,0,"ion-icon",23),l.qZA(),l.TgZ(10,"ion-item-options",24),l.TgZ(11,"ion-item-option",17),l.NdJ("click",function(){const t=l.CHM(i).$implicit;return l.oxw(2).goMapTab(t.id_servicio)}),l._UZ(12,"ion-icon",25),l.qZA(),l.qZA(),l.qZA()}if(2&i){const i=t.$implicit;l.xp6(5),l.Q6J("ngIf",i.icono_app_movil.length>12),l.xp6(2),l.hij(" ",i.servicio," "),l.xp6(1),l.Q6J("ngIf",i.icono_app_movil.length<15),l.xp6(1),l.Q6J("ngIf",i.descargado)}}function y(i,t){if(1&i&&(l.TgZ(0,"div"),l.YNc(1,z,13,4,"ion-item-sliding",15),l.qZA()),2&i){const i=l.oxw();l.xp6(1),l.Q6J("ngForOf",i.servicios)}}const x=[{path:"",component:(()=>{class i{constructor(i,t,e,o,s,a,n){this.storage=i,this.rest=t,this.loadinCtrl=e,this.message=o,this.platform=s,this.router=a,this.alertCtrl=n,this.nombre="",this.email="",this.imgUser="",this.progress=!1,this.progressTotal=0,this.id_plaza=0,this.selecciona=!1}ngOnInit(){return(0,c.mG)(this,void 0,void 0,function*(){this.obtenerDatosUsuario(),this.platform.ready().then(()=>(0,c.mG)(this,void 0,void 0,function*(){yield this.obtenerPlazasUsuario()}))})}ionViewDidEnter(){this.platform.ready().then(()=>(0,c.mG)(this,void 0,void 0,function*(){yield this.obtenerPlazasUsuario()}))}obtenerPlazasUsuario(){return(0,c.mG)(this,void 0,void 0,function*(){this.plazasServicios=yield this.rest.obtenerPlazasSQL(),this.plazasServicios.length>0&&(this.id_plaza=this.plazasServicios[0].id_plaza),this.asignarServicios()})}asignarServicios(){return(0,c.mG)(this,void 0,void 0,function*(){this.servicios=yield this.rest.mostrarServicios(this.id_plaza),this.validaDescarga()})}validaDescarga(){this.servicios.forEach(i=>{i.descargado>0&&(this.progressTotal=100)})}resultPlaza(i){return(0,c.mG)(this,void 0,void 0,function*(){this.progressTotal=0,0!=this.id_plaza&&this.asignarServicios()})}actualizarEstatusDescarga(i,t){return(0,c.mG)(this,void 0,void 0,function*(){yield this.rest.actualizaServicioEstatus(i,t),this.asignarServicios()})}obtenerDatosUsuario(){return(0,c.mG)(this,void 0,void 0,function*(){this.nombre=yield this.storage.get("Nombre"),this.email=yield this.storage.get("Email");let i=yield this.rest.obtenerFotoUserSQL();this.imgUser=i[0].foto})}confirmarDescarga(i,t,e){return(0,c.mG)(this,void 0,void 0,function*(){const o=yield this.alertCtrl.create({header:t.toUpperCase(),subHeader:"Confirme para iniciar la descarga de "+e,buttons:[{text:"Cancelar",role:"cancel",cssClass:"secondary",handler:i=>{console.log("Confirm Cancel: blah")}},{text:"Confirmar",cssClass:"secondary",handler:()=>{this.descargarInformacion(this.id_plaza,i)}}]});yield o.present()})}descargarInformacion(i,t){return(0,c.mG)(this,void 0,void 0,function*(){this.progress=!0,this.deleteInfo(i,t),this.loading=yield this.loadinCtrl.create({message:"Descargando informaci\xf2n...",spinner:"dots"}),yield this.loading.present();const e=yield this.storage.get("IdAspUser");try{if(this.data=yield this.rest.obtenerDatosSql(e,i,t),this.total=this.data.length,0==this.total)return this.message.showAlert("No tienes cuentas asignadas para descargar"),void this.loading.dismiss();this.storage.set("total",this.total),yield this.guardarDatosSQL(this.data,i,t);var o=(new Date).toISOString();let s=new Date(o),a=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds())).toISOString();this.storage.set("FechaSync",a),this.loading.dismiss(),this.actualizarEstatusDescarga(this.id_plaza,t),this.getProcessByIdPlaza(this.id_plaza),this.message.showAlert("Se han descargado tus cuentas!!!!")}catch(s){console.log(s),yield this.loading.dismiss(),"HttpErrorResponse"===s.name&&this.message.showAlert("Error al descargar las cuentas, verificar conexi\xf3n a internet")}})}guardarDatosSQL(i,t,e){return(0,c.mG)(this,void 0,void 0,function*(){console.log("Guardando la informacion de "+e),console.log(i);let o=0;for(let s=0;s<i.length;s++)yield this.rest.guardarInfoSQL(i[s],t,e),o+=1,this.progressTotal=o/this.total})}deleteInfo(i,t){return(0,c.mG)(this,void 0,void 0,function*(){yield this.rest.deleteTable(i,t)})}getProcessByIdPlaza(i){return(0,c.mG)(this,void 0,void 0,function*(){if(this.dataProcess=yield this.rest.obtenerProcesosByIdPlaza(i),console.log(this.dataProcess),0===this.dataProcess.length)return void this.message.showToast("Esta plaza no tiene procesos de gesti\xf3n, verificar en ser0 web!!!!");const t=yield this.rest.processPlazaExists(i);console.log(t),t&&(yield this.rest.deleteProcessByIdPlaza(i)),this.dataProcess.forEach(i=>(0,c.mG)(this,void 0,void 0,function*(){let t=yield this.rest.insertProcessTable(i);this.message.showToast(t?`${i.nombre_proceso} listo...`:`${i.nombre_proceso} no se guardo`)}))})}goCuentasTab(i){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.rest.mostrarServicios(this.id_plaza);console.log(t),yield this.storage.set("NombrePlazaActiva",t[0].plaza),yield this.storage.set("IdPlazaActiva",t[0].id_plaza),yield this.storage.set("IdServicioActivo",i),console.log("IdServicioActivo "+i),console.log("IdPlazaActiva "+t[0].id_plaza),console.log("NombrePlazaActiva "+t[0].plaza),this.router.navigate(["/listado-cuentas",i,this.id_plaza])})}goMapTab(i){return(0,c.mG)(this,void 0,void 0,function*(){const t=yield this.rest.mostrarServicios(this.id_plaza);console.log(t),yield this.storage.set("NombrePlazaActiva",t[0].plaza),yield this.storage.set("IdPlazaActiva",t[0].id_plaza),yield this.storage.set("IdServicioActivo",i),console.log("IdServicioActivo "+i),console.log("IdPlazaActiva "+t[0].id_plaza),console.log("NombrePlazaActiva "+t[0].plaza),this.router.navigate(["mapa-prueba",i,this.id_plaza])})}}return i.\u0275fac=function(t){return new(t||i)(l.Y36(d.Ke),l.Y36(g.v),l.Y36(o.HT),l.Y36(h.K),l.Y36(o.t4),l.Y36(r.F0),l.Y36(o.Br))},i.\u0275cmp=l.Xpm({type:i,selectors:[["app-tab1"]],decls:25,vars:9,consts:[["color","medium"],["color","success","buffer","0.1",3,"value"],["id","principal"],[4,"ngIf"],[1,"texto-centrado"],["color","success"],[1,"datos"],["interface","popover","placeholder","Seleccionar plaza",1,"myCustomSelect",3,"ngModel","ionChange","ngModelChange"],["text-black","",3,"value",4,"ngFor","ngForOf"],["style","text-align: center;",4,"ngIf"],["alt","Foto de perfil no cargada",1,"img-perfil",3,"src"],["src","./assets/avatars/av-2.png","alt","Foto de perfil no cargada",1,"img-perfil"],["text-black","",3,"value"],[2,"text-align","center"],["src","../../assets/img/selecciona_plaza.png","alt","",2,"width","100px","height","100px"],[4,"ngFor","ngForOf"],["side","start"],["color","secondary",3,"click"],["slot","icon-only","name","layers"],["color","danger",1,"btn-cuentas",3,"click"],["style","width: 25px;","slot","start",3,"src",4,"ngIf"],[2,"color","white"],["color","light","slot","start",3,"name",4,"ngIf"],["color","success","name","checkmark-done","slot","end",4,"ngIf"],["side","end"],["slot","icon-only","name","map"],["slot","start",2,"width","25px",3,"src"],["color","light","slot","start",3,"name"],["color","success","name","checkmark-done","slot","end"]],template:function(i,t){1&i&&(l.TgZ(0,"ion-content",0),l._UZ(1,"hr"),l._UZ(2,"hr"),l._UZ(3,"hr"),l._UZ(4,"hr"),l._UZ(5,"hr"),l._UZ(6,"hr"),l._UZ(7,"hr"),l._UZ(8,"ion-progress-bar",1),l.TgZ(9,"div",2),l.TgZ(10,"ion-row"),l.TgZ(11,"ion-col"),l.YNc(12,p,2,1,"div",3),l.YNc(13,u,2,0,"div",3),l.qZA(),l.qZA(),l.TgZ(14,"div",4),l.TgZ(15,"ion-chip",5),l._uU(16),l.qZA(),l.TgZ(17,"p",6),l._uU(18),l.qZA(),l.TgZ(19,"p",6),l.TgZ(20,"ion-select",7),l.NdJ("ionChange",function(i){return t.resultPlaza(i)})("ngModelChange",function(i){return t.id_plaza=i}),l.YNc(21,m,3,4,"ion-select-option",8),l.qZA(),l.qZA(),l.qZA(),l._UZ(22,"hr"),l.YNc(23,v,6,0,"div",9),l.YNc(24,y,2,1,"div",3),l.qZA(),l.qZA()),2&i&&(l.xp6(8),l.Q6J("value",t.progressTotal),l.xp6(4),l.Q6J("ngIf",t.imgUser),l.xp6(1),l.Q6J("ngIf",!t.imgUser),l.xp6(3),l.hij("Bienvenido ",t.nombre,""),l.xp6(2),l.hij(" ",t.email," "),l.xp6(2),l.Q6J("ngModel",t.id_plaza),l.xp6(1),l.Q6J("ngForOf",t.plazasServicios),l.xp6(2),l.Q6J("ngIf",0==t.id_plaza),l.xp6(1),l.Q6J("ngIf",0!=t.id_plaza))},directives:[o.W2,o.X7,o.Nd,o.wI,s.O5,o.hM,o.t9,o.QI,a.JJ,a.On,s.sg,o.n0,o.td,o.IK,o.u8,o.gu,o.Ie],pipes:[s.rS],styles:["ion-col[_ngcontent-%COMP%]{text-align:center;margin-top:30px}.img-perfil[_ngcontent-%COMP%]{width:120px;height:120px;border-radius:50%!important}.datos[_ngcontent-%COMP%], .texto-centrado[_ngcontent-%COMP%]{text-align:center}.datos[_ngcontent-%COMP%]{font-size:15px;color:#fff}#principal[_ngcontent-%COMP%]{padding:0 10%}.descarga[_ngcontent-%COMP%]{margin-top:20px!important}ion-item-sliding[_ngcontent-%COMP%]{margin-top:20px}"]}),i})()}];let A=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=l.oAB({type:i}),i.\u0275inj=l.cJS({imports:[[r.Bz.forChild(x)],r.Bz]}),i})();var b=e(5530);let T=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=l.oAB({type:i}),i.\u0275inj=l.cJS({imports:[[o.Pc,s.ez,a.u5,n.e,A,b.K]]}),i})()}}]);